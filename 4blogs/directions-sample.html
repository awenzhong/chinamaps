<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns="http://www.w3.org/1999/xhtml"><head>

  
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Google Maps API Example: Simple Geocoding</title>
    <script src="http://ditu.google.com/maps?hl=zh-CN&file=api&amp;v=2&amp;key=ABQIAAAA91OZMiOe8VfhdtstxQrBBxQMwdEejL6PNWQ60w7dBVYMUBtoYxSzpO8QrLyX6KzYJkpyIz3Q53terg"></script>
    <script type="text/javascript">

    var map = null;
    var direction = null;

    function initialize() {
      if (GBrowserIsCompatible()) {
        map = new GMap2($("map_canvas") );
        map.setCenter(new GLatLng(39.997383, 116.730885), 15);
        direction = new GDirections(map, $("route_result"));
        GEvent.addListener(direction, "error", handleErrors);
        GEvent.addListener(direction, "load", onGDirectionsLoad);
//        direction.loadFromWaypoints(["北京","上海","广州"], {locale:"zh-CN"});
        var ad = new GAdsManager(map, "ca-pub-6927261237267365",{minZoomLevel:2});
        ad.enable();
        map.openInfoWindowHtml(map.getCenter(), "广告");
      }
    }
    function $(id){
      return document.getElementById(id);
    }
    function getDirection(from, to) {
//      var mode = document.getElementById("travlMode").value;
//      var isAvoidHighway = document.getElementById("avoidHighways").checked;
      direction.load("from:"+from+" to:"+to, {locale:"zh-CN", avoidHighways:true});
      
    }
    function handleErrors(){
      var status = direction.getStatus();
      switch(status.code) {
	      case G_GEO_BAD_REQUEST :
          alert("定向查询条件设定有误");
		      break;
	      case G_GEO_SERVER_ERROR :
          alert("服务器不能正确解析你输入的地址");
		      break;
        case G_GEO_MISSING_QUERY :
        case G_GEO_MISSING_ADDRESS :
          alert("查询条件（地址）不能为空");
          break;
        case G_GEO_UNKNOWN_ADDRESS :
          alert("查询地址未知");
          break;
        case G_GEO_UNAVAILABLE_ADDRESS :
          alert("因当地法律或其他原因不能解析给出地址");
          break;
        case G_GEO_UNKNOWN_DIRECTIONS :
          alert("给出的两地之间无路可走或我们的现有的数据中缺少定向路线");
          break;
        case G_GEO_BAD_KEY :
          alert("导入类库是指定的密钥有误");
          break;
        case G_GEO_TOO_MANY_QUERIES :
          alert("查询太过频繁，超出密钥允许的查询次数");
          break;
      }
    }
    function onGDirectionsLoad(){
      if(direction.getStatus().code==200){
        var numRoute = direction.getNumRoutes();
        var numGeocode = direction.getNumGeocodes();
        var cpHtml = direction.getCopyrightsHtml();
        var route = direction.getRoute(0);
        var num = route.getNumSteps();
        var sum = route.getSummaryHtml();
        var html = "Route num:"+numRoute+" copyright:"+cpHtml+"<br/> route num:"+num+" route sum:"+sum;
        $("direction_result").innerHTML = html;
      }
    }
    </script>
  </head>
  <body onload="initialize();" onunload="GUnload();">
    <form action="#" onsubmit="getDirection(this.from.value, this.to.value); return false">
      <p>
        <input size="60" name="from" value="北京" type="text">
        <input size="60" name="to" value="上海" type="text">
        <!--定向模式<select id="travlMode">
          <option value="G_TRAVEL_MODE_DRIVING">驾车</option>
          <option value="G_TRAVEL_MODE_WALKING">步行</option>
        </select>
        避开高速公里<input type="checkbox" id="avoidHighways"/>-->
        <input value="Go!" type="submit">
      </p>
      <div id="route_result" style="width:300px;height:400px;overflow:auto;font-size:13px;float:left;"></div>
      <div id="map_canvas" style="width:400px;height:400px;float:left;"></div>
      <p id="direction_result"></p>
    </form>
  </body></html>