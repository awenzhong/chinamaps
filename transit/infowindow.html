<head>
  <style>
  body{
	font-size:13px;
	font-family:Arial,sans-serif;
	color:#000;
	background:#fff
  }
  p,div{
    margin:0;
    padding:0;
    border:0;
  }
  .list-line-name{
    font-weight:bold;
    border:#666 solid 1px;
    padding:1px 2px;
  }
  .plyIcon{
    width:16px;
    height:9px;
    background:url("http://chinamaps.googlecode.com/svn/transit/icons/plyIcon.gif") no-repeat left center;
  }
  html>body .plyIcon{
    padding:2px 8px;
  }
  </style>
</head>
<body>
<div id="container">
  <span>公交路线加载中...</span>
</div>

<script type="text/javascript">
(function(){
  var container = document.getElementById("container");
  var params = window.location.search.match(/\?stop=(.+)\&city=(.+)/);
  var paramStr = "api=ls&sn="+params[1]+"&city="+params[2]+"&callback=Transit.fillLines";
  container.innerHTML = "加载经过"+decodeURIComponent(params[1])+"的公交路线..";
  
  function request(paramStr){
    var backend_url = "http://211.157.3.197:8080/transit/";
    var url = backend_url + "?" + paramStr + "&random=" + Math.random();
    var scriptTag = document.createElement('script');
    scriptTag.setAttribute('type', 'text/javascript');
    scriptTag.setAttribute('charset', 'utf-8');
    scriptTag.setAttribute('id', 'jsonpScriptTag');
    scriptTag.setAttribute('src', url);
    var oldTag = document.getElementById('jsonpScriptTag');
    var head = document.getElementsByTagName('head')[0];
    if (oldTag) {
      head.removeChild(oldTag);
    }
    head.appendChild(scriptTag);
  }
  
  function fillLines(lines){
    var html = '';
    var existLines = {};
    for(var i = 0, item; item = lines[i]; i++){
      var id = item['line_id'];
  	  var name = item['short_name'];
  	  var start = item['start_station'];
  	  var end = item['end_station'];
  	  if(existLines[name]) continue;
  	  html += '<div style="position:relative;margin:5px 3px;overflow:hidden;">';
      html += '<p style="float:left;width:38%;margin:3px;">';
      html += '<span class="list-line-name" onclick=Transit.sendMsg(\'' + id + '\') onmouseover="style.backgroundColor=\'#c0c0c0\';style.cursor=\'pointer\'" onmouseout="style.backgroundColor=\'#fff\';">' + name + '</span></p>';
      html += '<p style="float:right; width:57%;">' + start + '<a class="plyIcon"></a>' + end + '</p>';
      html += '</div>';
      existLines[name] = name;
    }
    container.innerHTML = html; 
  }
  
  function sendMsg(lineId){
    //var url = "http://chinamaps.googlecode.com/svn/transit/infowindow.html";
    //window.location = url+"#"+lineId;
    Transit.lineId = lineId;
  }
  window['Transit'] = {
    'fillLines' : fillLines,
    'sendMsg' : sendMsg
  }
   
  request(paramStr);
})()
 

</script>    
</body>